<div class="main-content">
    <div class="content-wrapper">
        <div class="page-header">
            <h2>Crear Nueva Película</h2>
            <p>Agrega una nueva película a tu catálogo cinematográfico</p>
        </div>

        <div class="form-container">
            <form [formGroup]="peliculaForm" (ngSubmit)="onSubmit()" class="form-grid">

                <div class="image-upload-section">
                    <label class="image-upload">
                        <input type="file" accept="image/*" (change)="onImageSelected($event)" style="display: none;">
                        <ng-container *ngIf="imagenPreview; else uploadIcon">
                            <img [src]="imagenPreview" alt="Vista previa" class="img-preview" />
                        </ng-container>
                        <ng-template #uploadIcon>
                            <i class="fa-solid fa-plus"></i>
                            <div class="text">Agregar Imagen</div>
                        </ng-template>
                    </label>
                </div>

                <div class="form-fields">
                    <div class="form-field">
                        <label for="titulo">Título</label>
                        <input type="text" id="titulo" formControlName="titulo"
                            placeholder="Ingrese el título de la película">
                        <div *ngIf="peliculaForm.get('titulo')?.invalid && peliculaForm.get('titulo')?.touched"
                            class="crear-pelicula-error">
                            El título es obligatorio.
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="form-field">
                            <label for="duracion_minutos">Duración (min)</label>
                            <input type="number" id="duracion_minutos" formControlName="duracion_minutos"
                                placeholder="120" min="1" required>
                            <div *ngIf="peliculaForm.get('duracion_minutos')?.invalid && peliculaForm.get('duracion_minutos')?.touched"
                                class="crear-pelicula-error">
                                La duración es obligatoria y debe ser un número positivo.
                            </div>

                        </div>
                        <div class="form-field">
                            <label for="clasificacion">Clasificación</label>
                            <select id="clasificacion" formControlName="clasificacion" required>
                                <option value="" disabled selected>Seleccione una clasificación</option>
                                <option *ngFor="let clasificacion of clasificaciones" [value]="clasificacion">
                                    {{ clasificacion }}
                                </option>
                            </select>
                            <div *ngIf="peliculaForm.get('clasificacion')?.invalid && peliculaForm.get('clasificacion')?.touched"
                                class="crear-pelicula-error">
                                La clasificación es obligatoria.
                            </div>
                        </div>
                    </div>

                    <div class="form-field">
                        <label for="descripcion">Descripción</label>
                        <textarea id="descripcion" formControlName="descripcion"
                            placeholder="Ingrese una descripción detallada de la película..." required></textarea>
                        <div *ngIf="peliculaForm.get('descripcion')?.invalid && peliculaForm.get('descripcion')?.touched"
                            class="crear-pelicula-error">
                            La descripción es obligatoria.
                        </div>

                    </div>

                    <div class="field-row-three">
                        <div class="form-field">
                            <label for="fecha_estreno">Fecha de Estreno</label>
                            <input type="date" id="fecha_estreno" formControlName="fecha_estreno" required>
                            <div *ngIf="peliculaForm.get('fecha_estreno')?.invalid && peliculaForm.get('fecha_estreno')?.touched"
                                class="crear-pelicula-error">
                                La fecha de estreno es obligatoria.
                            </div>

                        </div>

                        <div class="form-field">
                            <label for="generos">Agregar Género</label>
                            <select id="generos" formControlName="generos" #generoSelect (change)="addGenre(generoSelect.value)">
                                <option value="">Seleccione un genero</option>
                                <option *ngFor="let genero of generos" [value]="genero">
                                    {{ genero }}
                                </option>
                            </select>
                        </div>

                        <div class="form-field">
                            <label for="estado">Estado</label>
                            <select id="estado" formControlName="estado">
                                <option value="">Seleccione un estado</option>
                                <option value="activo">Estreno</option>
                                <option value="proximamente">Próximamente</option>
                                <option value="retirada">Retirada</option>
                            </select>
                        </div>
                    </div>

                    <div class="multi-select">
                        <label>Géneros Seleccionados</label>
                        <div id="genresTags" class="tags-container" [class.has-tags]="selectedGenres.length > 0">
                            <div *ngIf="selectedGenres.length === 0" class="empty-state">
                                No hay géneros seleccionados
                            </div>
                            <div *ngFor="let genre of selectedGenres" class="tag">
                                {{ genre }}
                                <span class="tag-remove" (click)="removeGenre(genre)">×</span>
                            </div>
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="form-field">
                            <label for="etiquetas">Agregar Etiqueta</label>
                            <select id="etiquetas" formControlName="etiquetas" #etiquetasSelect (change)="addTag(etiquetasSelect.value)">
                                <option value="">Seleccione un genero</option>
                                <option *ngFor="let etiqueta of etiquetas" [value]="etiqueta">
                                    {{ etiqueta }}
                                </option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="director">Director</label>
                            <input type="text" id="director" name="director" placeholder="Nombre del director">
                        </div>
                    </div>

                    <div class="multi-select">
                        <label>Etiquetas Seleccionadas</label>
                        <div id="tag" class="tags-container" [class.has-tags]="selectedTags.length > 0">
                            <div *ngIf="selectedTags.length === 0" class="empty-state">
                                No hay géneros seleccionados
                            </div>
                            <div *ngFor="let tag of selectedTags" class="tag">
                                {{ tag }}
                                <span class="tag-remove" (click)="removeTag(tag)">×</span>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

            <div class="submit-section">
                <button type="submit" class="submit-btn" onclick="createMovie()">
                    Crear Película
                </button>
            </div>
        </div>
    </div>
</div>