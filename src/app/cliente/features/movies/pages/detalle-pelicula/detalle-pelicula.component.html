<nav class="breadcrumb-nav">
  <span routerLink="/inicio" class="breadcrumb-link">Inicio</span>
  <span class="breadcrumb-sep">›</span>
  <span class="breadcrumb-link" routerLink="/carrusel-general">Cartelera</span>
  <span class="breadcrumb-sep">›</span>
  <span class="breadcrumb-current">{{ pelicula?.titulo }}</span>
</nav>

<div class="detalle-content" *ngIf="pelicula as p">
  <div class="detalle-img">
    <img [src]="p.imagen" [alt]="p.titulo" class="detalle-img-portada" />
    
    <div class="trailer-modal" *ngIf="mostrarTrailer">
      <button class="trailer-close" (click)="cerrarTrailer()" aria-label="Cerrar tráiler">
        <span class="material-icons">close</span>
      </button>
      <div class="trailer-modal-content">
        <iframe
          [src]="safeTrailerUrl"
          title="YouTube video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  </div>
  <section class="detalle-info">
    <header>
      <h2 class="detalle-titulo">{{ p.titulo }}</h2>
      <div class="detalle-edad">Clasificacion: {{ p.clasificacion }}</div>
      <div class="detalle-duracion">{{ p.duracion_minutos }} min</div>
      <p class="detalle-descripcion">{{ p.descripcion }}</p>
    </header>
    <div class="detalle-idiomas" *ngIf="funcionesPorIdioma.length > 0">
      <button
        *ngFor="let idioma of funcionesPorIdioma"
        [class.active]="idioma.idioma === idiomaSeleccionado"
        (click)="cambiarIdioma(idioma.idioma, idioma.trailer)"
      >
        {{ idioma.idioma }}
      </button>
    </div>
    
    <div class="no-funciones-message" *ngIf="funcionesPorIdioma.length === 0">
      <p class="info-message">No hay funciones disponibles para esta película en este momento.</p>
    </div>
    <div class="detalle-horarios" *ngIf="obtenerHorariosPorIdioma().length > 0">
      <h3>Horarios disponibles</h3>
      <ul>
        <li *ngFor="let horario of obtenerHorariosPorIdioma()">{{ horario }}</li>
      </ul>
    </div>
    <hr>
    <div class="detalle-cantidad-precio">
      <div class="detalle-cantidad">
        <span class="detalle-cantidad-label">Cantidad</span>
        <div class="cantidad-control">
          <button (click)="cambiarCantidad(-1)" [disabled]="cantidad <= 1">-</button>
          <span>{{ cantidad }}</span>
          <button (click)="cambiarCantidad(1)">+</button>
        </div>
      </div>
      <div class="detalle-precio" *ngIf="funcionesPorIdioma.length > 0">
        <span class="detalle-precio-label">Precio</span>
        <span class="detalle-precio-valor">${{ obtenerPrecioPorIdioma() }}</span>
      </div>
    </div>
    <hr>
    <div class="detalle-btn-row">
      <button class="btn-trailer" 
              (click)="abrirTrailer()" 
              *ngIf="safeTrailerUrl"
              aria-label="Ver tráiler">
        Ver Tráiler
      </button>
      <button class="btn-siguiente" 
              (click)="irASiguiente()"
              [disabled]="funcionesPorIdioma.length === 0">
        Siguiente
      </button>
    </div>
  </section>
</div>

<h2 class="cartelera-titulo">PELÍCULAS EN CARTELERA</h2>
<app-carousel-estrenos></app-carousel-estrenos>
<hr>